!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Endpoints=b()}(this,function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;return a=function(a){return null===a},b=function(a){return"undefined"==typeof a},c=function(a){return JSON.parse(JSON.stringify(a))},d=function(a,b){var c=a[b];return delete a[b],c},e=function(a,b,c,d){var e={isNull:a,isUndefined:b,jsonClone:c,snip:d};return e.merge=function(a,b){for(var c in b)a[c]=b[c];return a},e}(a,b,c,d),f=function(a){return a===Object(a)},g=function(a){return"[object Array]"===Object.prototype.toString.call(a)},h=function(a,b){var c=function(d,e){for(var f in e){var g=d[f]||{},h=e[f],i=b(h),j=a(h);i||j?(i&&!b(g)&&(d[f]={}),j&&!a(g)&&(d[f]=[]),d[f]=c(g,h)):d[f]=h}return d};return c}(g,f),i=function(a,b,c){return{isObject:b,isArray:a,deepMerge:c}}(g,f,h),j=function(a){var b=function(a){this.seperator=a||"."};return b.prototype.get=function(a,b){var c;return this._loop(a,b,{last:function(a,b,d){c=a[b[d]]},missing:function(){return!1}}),c},b.prototype.set=function(b,c,d,e){return this._loop(b,c,{last:function(b,c,f){var g=b[c[f]];return b[c[f]]="object"==typeof g&&e?a.deepMerge(g,d):d},missing:function(a,b,c){a[b[c]]={}}}),d},b.prototype.remove=function(a,b){var c=b.lastIndexOf(":"),d=b,e=a;c>0&&(e=this.get(a,b.slice(0,c)),d=b.slice(c+1)),delete e[d]},b.prototype._loop=function(a,b,c){for(var d=b.split(this.seperator),e=0,f=d.length;f>e;e++){if(f===e+1)return void c.last(a,d,e);if(!a[d[e]]&&c.missing(a,d,e)===!1)return void 0;a=a[d[e]]}},b}(i),k=function(a,b,c){var d=new c(":"),e={isObject:a,jsonClone:b};return e.mix=function(a,b,c){for(var e in b)d.set(a,e,b[e],!c);return a},e.get=function(a,b){return d.get(a,b)},e.set=function(a,b,c,e){return d.set(a,b,c,e)},e.remove=function(a,b){return d.remove(a,b)},e}(f,c,j),l=function(a){var b=function(b){this.original=a.mix({},b),this.reset()};return b.prototype.add=function(b,c){return a.isObject(b)?a.mix(this.data,b,c):a.set(this.data,b,c),this},b.prototype.remove=function(b){a.remove(this.data,b)},b.prototype.reset=function(){this.data=a.jsonClone(this.original)},b.prototype.get=function(b){return b?a.get(this.data,b):this.data},b}(k),m=function(a){var b=a.type;return"POST"!==b&&"PUT"!==b||!a.data||(a.data=JSON.stringify(a.data)),a},n=function(a,b,c){var d=function(a,b){this.ajax=a,this.root=b};return d.prototype.configure=function(c){c=a.jsonClone(c),this.store=new b({client_id:a.snip(c,"client_id"),client_secret:a.snip(c,"client_secret"),resources:this.root}),this.defaults=new b(c)},d.prototype.options=function(a,b,c){return this._options(a,b,c)},d.prototype.request=function(a,b,c){return this.ajax(this._options(a,b,c))},d.prototype._options=function(d,e,f){f=a.merge({},f);var g=a.snip(f,"data"),h=a.snip(f,"args"),i=this._getResource(e),j=this._getEndpoint(e,i,d),k=j.params;g=g||{},this._hasRequired(k,g),this._isValid(k,g);var l=new b(this.defaults.get());return l.add("url",l.get("url")+e),l.add("type",d),l.add("data",g),l.add("headers",j.headers),this._addAuth(j,l),this._addArgs(h,l),a.merge(c(l.get()),f)},d.prototype._getResource=function(a){var b=this.store.get("resources:"+a);if(!b)throw new ReferenceError("No resource exists at `"+a+"`.");return b},d.prototype._getEndpoint=function(a,b,c){var d=b.options[c];if(!d)throw new ReferenceError("Resource `"+a+"` does not have a `"+c+"` endpoint.");return d},d.prototype._hasRequired=function(b,c){for(var d in b){var e=c[d];if(b[d]&&(a.isUndefined(e)||a.isNull(e)))throw new Error("Required param `"+d+"` missing.")}},d.prototype._isValid=function(b,c){for(var d in c)if(a.isUndefined(b[d]))throw new Error("The endpoint does not accept the key: `"+d+"`")},d.prototype._addAuth=function(a,b){if(a.authorization){var c=this["_auth"+a.authorization]();b.add("headers:Authorization",c)}},d.prototype._addArgs=function(a,b){if(a){var c="/"+a.join("/"),d=b.get("url")+c;b.add("url",d)}},d.prototype._authBasic=function(){var a=this.store.get("client_id"),b=this.store.get("client_secret"),c=window.btoa(a+":"+b);return"Basic "+c},d.prototype._authBearer=function(){var a=this.store.get("access_token");return"Bearer "+a},d}(e,l,m)});